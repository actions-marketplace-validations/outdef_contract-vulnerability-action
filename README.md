# contract-vulnerability-action

This action allows you to run `echidna-test` from within a GitHub Actions
workflow. The action builds on the `trailofbits/echidna` Docker image, adding
`solc-select` and providing a simpler way to execute Echidna as part of an
Actions workflow.

To learn more about [Echidna](https://github.com/crytic/echidna) itself, visit
its [GitHub repository](https://github.com/crytic/echidna) and [wiki
pages](https://github.com/crytic/echidna/wiki).

## Inputs

### Echidna

| Key                  | Description                                                                                  |
| -------------------- | -------------------------------------------------------------------------------------------- |
| `files`              | Solidity files or folders to analyze.                                                        |
| `contract`           | Contract to analyze.                                                                         |
| `config`             | Config file (CLI arguments override config options).                                         |
| `format`             | Output format: json, text, none. Disables interactive UI.                                    |
| `corpus-dir`         | Directory to store corpus and coverage data.                                                 |
| `test-mode`          | Type of tests to be performed: property, assertion, overflow, optimization, exploration.     |
| `multi-abi`          | Use multi-abi mode of testing.                                                               |
| `test-limit`         | Number of sequences of transactions to generate during testing.                              |
| `shrink-limit`       | Number of tries to attempt to shrink a failing sequence of transactions.                     |
| `seq-len`            | Number of transactions to generate during testing.                                           |
| `contract-addr`      | Address to deploy the contract to test.                                                      |
| `deployer`           | Address of the deployer of the contract to test.                                             |
| `sender`             | Addresses to use for the transactions sent during testing.                                   |
| `seed`               | Run with a specific seed.                                                                    |
| `crytic-args`        | Additional arguments to use in crytic-compile for the compilation of the contract to test.   |
| `solc-args`          | Additional arguments to use in solc for the compilation of the contract to test.             |
| `solc-version`       | Version of the Solidity compiler to use.                                                     |
| `output-file`        | Capture echidna-test's output into a file. The path must be relative to the repository root. |
| `echidna-version`    | Version of the Echidna Docker image to use.                                                  |
| `negate-exit-status` | Apply logical NOT to echidna-test's exit status (for testing the action).                    |
| `echidna-workdir`    | Path to run echidna-test from. Note that `files` and `config` are relative to this path.     |

### Slither

| Key              | Description                                                                                                                                                                                    |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `fail-on`        | Cause the action to fail if Slither finds any issue of this severity or higher. See [action fail behavior](#action-fail-behavior).                                                             |
| `sarif`          | If provided, the path of the SARIF file to produce, relative to the repo root.                                                                                                                 |
| `slither-args`   | Extra arguments to pass to Slither.                                                                                                                                                            |
| `slither-config` | The path to the Slither configuration file. By default, `./slither.config.json` is used if present. See [Configuration file](https://github.com/crytic/slither/wiki/Usage#configuration-file). |
| `target`         | The path to the root of the project to be analyzed by Slither. It can be a directory or a file, and it defaults to the repo root or `echidna-workdir` if set.                                  |

## Outputs

| Key           | Description                                                                              |
| ------------- | ---------------------------------------------------------------------------------------- |
| `output-file` | If produced, the file containing echidna-test's output, relative to the repository root. |

### Action fail behavior

The Slither action supports a `fail-on` option, based on the `--fail-*` flags
added in Slither 0.8.4. To maintain the current action behavior, this option
defaults to `all`. The following table summarizes the action behavior across
different Slither versions. You may adjust this option as needed for your
workflows. If you are setting these options on your config file, set `fail-on:
config` to prevent the action from overriding your settings.

| `fail-on`          | Slither <= 0.8.3          | Slither > 0.8.3               |
| ------------------ | ------------------------- | ----------------------------- |
| `all` / `pedantic` | Fail on any finding       | Fail on any finding           |
| `low`              | Fail on any finding       | Fail on any finding >= low    |
| `medium`           | Fail on any finding       | Fail on any finding >= medium |
| `high`             | Fail on any finding       | Fail on any finding >= high   |
| `none`             | Do not fail on findings   | Do not fail on findings       |
| `config`           | Determined by config file | Determined by config file     |

## Example usage

```yaml
jobs:
  analysis:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: packages/contracts

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v2
        with:
          node-version: "16.x"
          cache: "npm"
      - name: Install dependencies
        run: npm install
      - name: Compile contracts
        run: npx hardhat compile
      - name: Run Analysis
        uses: outdef/contract-vulnerability-action
        with:
          solc-version: 0.8.17
          echidna-workdir: "packages/contracts"
          files: .
          format: "text"
          test-mode: "assertion"
          contract: TokenUpgradeable,StakeUpgradeable,DAOUpgradeable
          crytic-args: --hardhat-ignore-compile
          target: "."
          fail-on: "medium"
          slither-config: "packages/contracts/slither.config.json"
```
